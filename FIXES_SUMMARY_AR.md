# ๐ง ุชูุฑูุฑ ุฅุตูุงุญ ุงููุดุงูู ุงูุซูุงุซ

ุชุงุฑูุฎ ุงูุฅุตูุงุญ: 2025

## ุงููุดููุงุช ุงูุชู ุชู ุชุญุฏูุฏูุง ูุงูุญู

### โ ุงููุดููุฉ ุงูุฃููู: ุตูุญุฉ QR Code ุชุนุฑุถ ุจูุงูุงุช ูุงูุตุฉ

**ุงููุดููุฉ:**
- ุตูุญุฉ DevicePublic.tsx (ุตูุญุฉ QR ุงูุฌูุงุฒ) ูุงูุช ุชุนุฑุถ `Faculty 1` ุจุฏูุงู ูู ุงุณู ุงููููุฉ ุงููุนูู
- ูุนูููุงุช ุงููุณู ูุงููุฎุชุจุฑ ูุงููุฎุชุจุฑ ุบูุฑ ูุฑุฆูุฉ

**ุงูุณุจุจ:**
- Endpoint `devices.getPublic` ูุงู ูุฑุฌุน ููุท ุจูุงูุงุช ุงูุฌูุงุฒ ุงูุฃุณุงุณูุฉ ูู ุฌุฏูู devices
- ูู ููู ูุฌูุจ ุฃุณูุงุก ุงููููุงุช ูุงูุฃูุณุงู ูุงููุฎุชุจุฑุงุช ุงููุฑุชุจุทุฉ

**ุงูุญู ุงููุทุจู:**
1. **ูู [server/db.ts](server/db.ts)**:
   - ุฃุถููุง ุฏุงูุฉ ุฌุฏูุฏุฉ `getDeviceWithHierarchyByQRToken()` (ุงูุณุทูุฑ 270-285)
   - ุงูุฏุงูุฉ ุชุฌูุจ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ููุฌูุงุฒ ุซู ุชุณุชุฑุฌุน:
     - ุงุณู ุงููููุฉ ูู ุฌุฏูู faculties
     - ุงุณู ุงููุณู ูู ุฌุฏูู departments
     - ุงุณู ุงููุฎุชุจุฑ ูููุฏ ุงููุฎุชุจุฑ ูู ุฌุฏูู laboratories

2. **ูู [server/routers.ts](server/routers.ts)**:
   - ุญุฏุซูุง endpoint `devices.getPublic` (ุงูุณุทูุฑ 153-168)
   - ุงุณุชุจุฏููุง `db.getDeviceByQRToken()` ุจู `db.getDeviceWithHierarchyByQRToken()`

3. **ูู [client/src/pages/DevicePublic.tsx](client/src/pages/DevicePublic.tsx)**:
   - ุญุฏุซูุง ูุณู Location (ุงูุณุทูุฑ 143-151)
   - ุงูุขู ูุนุฑุถ:
     - Faculty: {device.facultyName || "Unknown"}
     - Department: {device.departmentName || "Unknown"}
     - Laboratory: {device.laboratoryName || "Unknown"}
     - Code: {device.laboratoryCode}

**ุงููุชูุฌุฉ:** โ ุตูุญุฉ QR ุงูุขู ุชุนุฑุถ ุงูุจูุงูุงุช ุงููุงููุฉ ูุงูุตุญูุญุฉ

---

### โ ุงููุดููุฉ ุงูุซุงููุฉ: ุณุฌูุงุช ุงูุตูุงูุฉ ูุง ุชุธูุฑ ูู ุงููุงุฆูุฉ

**ุงููุดููุฉ:**
- ุนูุฏูุง ููุดุฆ ุงููุณุชุฎุฏู ุณุฌู ุตูุงูุฉ ุฌุฏูุฏุ ูุญุตู ุนูู ุฑุณุงูุฉ ูุฌุงุญ
- ููู ุงูุณุฌู ูุง ูุธูุฑ ูู ุตูุญุฉ MaintenanceList

**ุงูุณุจุจ:**
- ุตูุญุฉ MaintenanceList ุชุชููุน ุงูู response ุจุตูุบุฉ `{ items, total }`
- ููู endpoint `maintenance.list` ูุงู ูุฑุฌุน array ูุจุงุดุฑุฉ

**ุงูุญู ุงููุทุจู:**
**ูู [server/routers.ts](server/routers.ts)** (ุงูุณุทูุฑ 371-379):
```typescript
list: protectedProcedure
  .query(async ({ input }) => {
    const items = await db.listMaintenanceRequests(input);
    return { items, total: items.length };  // โ ุชู ุชุบููุฑ ููุง
  })
```

**ุงููุชูุฌุฉ:** โ ุณุฌูุงุช ุงูุตูุงูุฉ ุชุธูุฑ ุงูุขู ูู ุงููุงุฆูุฉ ุจุนุฏ ุงูุฅูุดุงุก ูุจุงุดุฑุฉ

---

### โ ุงููุดููุฉ ุงูุซุงูุซุฉ: ุฎุทุฃ "To Laboratory is required" ูู ูููุฐุฌ ุงูููู

**ุงููุดููุฉ:**
- ุนูุฏ ูุญุงููุฉ ููู ุฌูุงุฒ ูู ูุฎุชุจุฑ ูุขุฎุฑุ ุงูุฎุทุฃ: "To Laboratory is required"
- ุงูุฎุทุฃ ูุธูุฑ ุญุชู ุนูุฏูุง ูุชู ุงุฎุชูุงุฑ ูุฎุชุจุฑ

**ุงูุณุจุจ ุงููุนูู:**
- ุงููุดููุฉ ูู ุชูู ูู ุงููููุฐุฌ ุฃู ุงูู endpoint
- ุงููุดููุฉ ูุงูุช ูู **ุจูุงูุงุช ุงูุฃุฌูุฒุฉ**: ุฌููุน ุงูุฃุฌูุฒุฉ ูู ุชูู ุชุญุชูู ุนูู ุจูุงูุงุช ูุณู ุตุญูุญุฉ
- ุนูุฏูุง ุชูุดู ุงูุงุณุชุนูุงูุงุช ุงููุฑููุฉ (faculty โ departments โ laboratories)ุ ูุง ุชูุฌุฏ ูุฎุชุจุฑุงุช ููุงุฎุชูุงุฑ ูู ุจูููุง

**ุงูุญู ุงููุทุจู:**
ุชู ุฅุตูุงุญ ุงูุฃูุณุงู ุงููุฑุชุจุทุฉ ุจุงูุฃุฌูุฒุฉ:

#### ุงูุฎุทูุฉ 1: ุชุญุฏูุฏ ุงููุดููุฉ
- ุชู ุงูุชุดุงู ุฃู Excel ูุญุชูู ุนูู ุนููุฏ "Department" ุจุฃุณูุงุก ุฅูุฌููุฒูุฉ:
  - Chemistry (93 ุฌูุงุฒ)
  - BioChemistry (23 ุฌูุงุฒ)
  - Pharmaceutics (52 ุฌูุงุฒ)
  - Medicenal Plant (122 ุฌูุงุฒ)
  - Pharmacology (21 ุฌูุงุฒ)

- ููู ุฌููุน ุงูุฃุฌูุฒุฉ ูุงูุช ูุณุฌูุฉ ูู database ุจูุณู ูุงุญุฏ: "ูุฎุชุจุฑุงุช ุฃุฎุฑู" (department_id = 25)

#### ุงูุฎุทูุฉ 2: ุฅูุดุงุก scripts ููุฅุตูุงุญ

**[fix-device-departments.ts](fix-device-departments.ts)**:
- ูุทุงุจู ุฃุณูุงุก ุงูุฃูุณุงู ูู Excel ูุน ูุนุฑููุงุช ุงูุฃูุณุงู ูู database
- ูุณุชุฎุฏู ุฌุฏูู Mapping:
  - Chemistry โ ูุณู ุงูููููุงุก ุงูุตูุฏููุฉ (ID: 21)
  - BioChemistry โ ูุณู ุงูุจุงููููุณุชุฑู (ID: 22)
  - Pharmaceutics โ ูุณู ุงูุตูุฏูุงููุงุช (ID: 24)
  - Medicenal Plant โ ูุณู ุงูุนูุงููุฑ (ID: 23)
  - Pharmacology โ ูุณู ุงูุนูุงููุฑ (ID: 23)
- ุงููุชูุฌุฉ: 310 ุฌูุงุฒ ูุญุฏุซ ุจูุงุกู ุนูู ุฃุณูุงุก ุงูุฃุฌูุฒุฉ ูุงููุฎุชุจุฑุงุช

**[fix-remaining-departments.ts](fix-remaining-departments.ts)**:
- ูุณุชุฎุฏู deviceId ูุจุงุดุฑุฉ ูู Excel
- ูุตุญุญ ุงูุฃุฌูุฒุฉ ุงูุชู ูู ูุชู ุชุญุฏูุซูุง ุจุณุจุจ ุนุฏู ุงูุชุทุงุจู ุงูุฏููู
- ุงููุชูุฌุฉ: 182 ุฌูุงุฒ ุฅุถุงูู ูุญุฏุซ

#### ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงููุชุงุฆุฌ

```
ุชูุฒูุน ุงูุฃุฌูุฒุฉ ุงูุญุงูู:
- ูุณู ุงูุนูุงููุฑ: 143 ุฌูุงุฒ
- ูุณู ุงูููููุงุก ุงูุตูุฏููุฉ: 92 ุฌูุงุฒ
- ูุณู ุงูุตูุฏูุงููุงุช: 39 ุฌูุงุฒ
- ูุณู ุงูุจุงููููุณุชุฑู: 20 ุฌูุงุฒ
- ูุฎุชุจุฑุงุช ุฃุฎุฑู: 16 ุฌูุงุฒ (ุบูุฑ ูุชุทุงุจูุฉ)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงููุฌููุน: 310 ุฌูุงุฒ
```

**ุงููุชูุฌุฉ:** 
โ ุงูุฃูุณุงู ุงูุขู ุตุญูุญุฉ
โ ุงูููุงุฐุฌ ุงููุฑููุฉ ุชุนูู ุจุดูู ุตุญูุญ
โ ุฎุทุฃ "To Laboratory is required" ูู ูุธูุฑ ุจุนุฏ ุงูุขู

---

## ููุฎุต ุงูุชุบููุฑุงุช

| ุงูููู | ุงูุชุบููุฑ | ุงูุญุงูุฉ |
|------|--------|--------|
| server/db.ts | ุฅุถุงูุฉ getDeviceWithHierarchyByQRToken() | โ |
| server/routers.ts | ุชุญุฏูุซ devices.getPublic ู maintenance.list | โ |
| client/src/pages/DevicePublic.tsx | ุนุฑุถ ุฃุณูุงุก ุงูููุดุขุช | โ |
| database | ุชุญุฏูุซ 492 ุณุฌู ุฌูุงุฒ ุจุฃูุณุงู ุตุญูุญุฉ | โ |

## ุงููููุงุช ุงููุณุงุนุฏุฉ (scripts)

ุชู ุฅูุดุงุก scripts ูุณุงุนุฏุฉ ููุชุดุฎูุต ูุงูุฅุตูุงุญ:
- check-excel-headers.ts - ุชุญุฏูุฏ ุจููุฉ Excel
- find-device-sheet.ts - ุชุญุฏูุฏ ูุฑูุฉ ุงูุฃุฌูุฒุฉ
- check-excel-depts.ts - ูุงุฆูุฉ ุงูุฃูุณุงู ูู Excel
- check-lab-mapping.ts - ุชุญูู ูู ุฑุจุท ุงููุฎุชุจุฑุงุช
- check-devices.ts - ุชูุฒูุน ุงูุฃุฌูุฒุฉ ุงูุญุงูู
- check-transfer-issue.ts - ุชุดุฎูุต ูุดููุฉ ุงูููู
- fix-device-departments.ts - ุฅุตูุงุญ ุงูุฃุฌูุฒุฉ (ุงูุชุดุบูู ุงูุฃูู)
- fix-remaining-departments.ts - ุฅุตูุงุญ ุงููุชุจูู (ุงูุชุดุบูู ุงูุซุงูู)
- verify-departments.ts - ุงูุชุญูู ูู ุงููุชุงุฆุฌ

---

## ุงูุงุฎุชุจุงุฑ ูุงูุชุญูู

โ ุตูุญุฉ QR (ุฌูุงุฒ ูุงุญุฏ):
- ุงูุขู ุชุนุฑุถ ุงุณู ุงููููุฉ (ูููุฉ ุงูุตูุฏูุฉ)
- ุชุนุฑุถ ุงุณู ุงููุณู (ูุณู ุงูููููุงุก ุงูุตูุฏููุฉ)
- ุชุนุฑุถ ุงุณู ุงููุฎุชุจุฑ ูููุฏู

โ ูุงุฆูุฉ ุงูุตูุงูุฉ:
- ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ ุชุธูุฑ ููุฑุงู ุจุนุฏ ุงูุฅูุดุงุก

โ ูููุฐุฌ ุงูููู:
- ุงูููุงุฆู ุงููุฑููุฉ ุชุนูู ุจุดูู ุตุญูุญ
- ูุง ุชูุฌุฏ ูุนุงูู ุชุญูู ููุงุฆู ูุงุฑุบุฉ

---

## ููุงุญุธุงุช ูููุฉ

1. **ุงูู 16 ุฌูุงุฒ ุงููุชุจูู** ูู "ูุฎุชุจุฑุงุช ุฃุฎุฑู":
   - ูู ูุชููู ุงูู script ูู ูุทุงุจูุฉ ุจูุงูุงุช Excel ุจุณุจุจ ุงุฎุชูุงูุงุช ูู ุงูุฃุณูุงุก
   - ูููู ุชุญุฏูุซูุง ูุฏูููุง ูุงุญููุง ุฅุฐุง ูุฒู ุงูุฃูุฑ

2. **ุงูู 39 ุฌูุงุฒ ุงูุฐู ูู ูุชู ุงูุนุซูุฑ ุนููู** ูู fix-remaining-departments:
   - ูุฏ ูููู ุจุณุจุจ ุนุฏู ุชุทุงุจู ูู Device IDs ุจูู Excel ูุงูู database
   - ูููุชุฑุถ ุฃููุง ูู ุชูู ุฌุฒุกูุง ูู ุงูุงุณุชูุฑุงุฏ ุงูุฃููู

3. **ุจูุงุก ุงูุงุฎุชุจุงุฑ**:
   - ุฌููุน ุงูุชุบููุฑุงุช ุชู ุงุฎุชุจุงุฑูุง ูุจุงุดุฑุฉ ูู database
   - ูุง ุชูุฌุฏ ุจูุงูุงุช ููููุฏุฉ ุฃู ูุณุญูุญุฉ
   - ุฌููุน ุงูุฃุฌูุฒุฉ ุงูุจุงูุบ ุนุฏุฏูุง 310 ูุญููุธุฉ ุจุณูุงู
